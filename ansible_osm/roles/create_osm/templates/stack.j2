heat_template_version: 2017-02-24

description: Template to deploy osm

parameters:
  image_osm:
    type: string
    description: Name of image osm
    default: osm

  ram_osm:
    type: string
    description: Ram for flavor osm
    default: 8192

  vcpu_osm:
    type: string
    description: VCPU for flavor osm
    default: 4

  disk_osm:
    type: string
    description: Disk for flavor osm
    default: 40

  public_key_osm:
    type: string
    description: Public key to access osm VM
    default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnybji2cFSYjLel1gkFP9hjetGcnageyUUcm7+PioSgdvZy0XprEom1p/q8uimxyEmDVFQPGnpJL008/mAz1yMeK8UHhOWqgH2JZZSJV/VKh+70iBO/Q6b7LKK84QwpeJ3vA6IVkxJwTHFVnHDTpYlR9FeoY7ZR9dLm9Xxu8/1rVvDwNAkx/AWIBKMXyrwSUnIiYggjfzTKqwv/VUtTY1MnFvTfq9bCFR8dxNKGe8a/0q7sMoXaCmV4mDGi3f960ErrR5rmNpVfAXYRdIvaHeK3jVrv/6fteNwOizC4f1Pg+uo+5lWR5JhyjJTIweq+brXnhgaey0ws+dPHwR0PGIl Generated by Nova

  public_net:
    type: string
    description: External network public name
    default: new_exct

  osm_floating_ip:
    type: string
    description: Foating IP address for external access to osm
    default: 10.255.73.105

  net_mgmt_name:
    type: string
    description: Management network address
    default: admin_net

resources:
#OSM:

  flavor_osm:
    type: OS::Nova::Flavor
    properties:
      disk: { get_param: disk_osm }
      ephemeral: 0
      flavorid: osm1
      is_public: False
      name: osm
      ram: { get_param: ram_osm }
      swap: 0
      vcpus: { get_param: vcpu_osm }

  key_osm:
    type: OS::Nova::KeyPair
    properties:
      name: key_osm
      public_key: { get_param: public_key_osm }

  OSM:
    type: OS::Nova::Server
    properties:
      name: OSM
      image: { get_param: image_osm }
      flavor: { get_resource: flavor_osm }
      key_name: { get_resource: key_osm }
      networks:
        - port: { get_resource: OSM_mgmt_port }

  OSM_mgmt_port:
    type: OS::Neutron::Port
    properties:
      network: { get_param: net_mgmt_name }

  OSM_mgmt_floating_ip:
    type: OS::Neutron::FloatingIP
    properties:
      floating_network: { get_param: public_net }
      port_id: { get_resource: OSM_mgmt_port }
      floating_ip_address: { get_param: osm_floating_ip }
